{% extends "layout.html" %}

{% block title %}Code | Pictures change{% endblock %}

{% block links %}
<link rel="stylesheet" href="{{ url_for('static', path='css/code.css') }}">
{% endblock %}


<iframe src="http://localhost:8000/converter" width="500px" height="500px"></iframe>
{% block content %}
<main>
    <h1>&lt;C&oacute;digo para comenzar /&gt;</h1>
    <hr>
    <h2>Inyectanos en tu proyecto</h2>
    <pre>
<span class="gray">&lt;</span><span class="blue">iframe</span> <span class="skyblue">src</span>=<span class="brown">&quot;http://localhost:8000/converter&quot;</span> <span class="skyblue">width</span>=<span class="brown">&quot;500px&quot;</span> <span class="skyblue">height</span>=<span class="brown">&quot;500px&quot;</span><span class="gray">&gt;</span></pre>
    <p>Con este iframe puedes agregar nuestra página de conversión de imágenes a tu proyecto.</p>
    <pre>
<span class="gray">&lt;</span><span class="blue">iframe</span> <span class="skyblue">src</span>=<span class="brown">&quot;http://localhost:8000/converter?color=green&quot;</span> <span class="skyblue">width</span>=<span class="brown">&quot;500px&quot;</span> <span class="skyblue">height</span>=<span class="brown">&quot;500px&quot;</span><span class="gray">&gt;</span></pre>
    <p>Puedes personalizar el color del iframa colocando en la fuente un parametro 'color' y el color que necesites.</p>

    <hr>
    <h2>Uso de nuestra API:</h2>    
    <p>Primero que todo creemos una función que nos permita imágenes por medio de blobs:</p>
    <pre><span class="blue">const</span> <span class="lightgreen">URL_</span> = <span class="skyblue">window</span>.<span class="lightgreen">URL</span> || <span class="skyblue">window</span>.<span class="lightgreen">webkitURL</span>;

<span class="blue">const</span> <span class="darke">downloadBlob</span> = <span class="darke">(</span><span class="skyblue">blob</span><span class="darke">)</span> <span class="darke">=></span> <span class="darke">{
    <span class="blue">let</span> <span class="skyblue">a</span> = <span class="skyblue">document</span>.<span class="yellow">createElement</span><span class="gold">(</span><span class="brown">"a"</span><span class="gold">)</span>;
    <span class="skyblue">document</span>.<span class="skyblue">body</span>.<span class="yellow">appendChild</span><span class="gold">(</span><span class="skyblue">a</span><span class="gold">)</span>;
    <span class="skyblue">a</span>.<span class="darke">style</span> = <span class="brown">"display: none"</span>;
    <span class="blue">const</span> <span class="darke">url</span> = <span class="lightgreen">URL_</span>.<span class="yellow">createObjectURL</span><span class="gold">(</span><span class="skyblue">blob</span><span class="gold">)</span>;
    <span class="skyblue">a</span>.<span class="skyblue">href</span> = <span class="darke">url</span>;
    <span class="skyblue">a</span>.<span class="skyblue">download</span> = <span class="brown">'imagen.jpeg'</span>;
    <span class="skyblue">a</span>.<span class="yellow">click</span><span class="gold">(</span><span class="gold">)</span>;
    <span class="lightgreen">URL_</span>.<span class="yellow">revokeObjectURL</span><span class="gold">(</span><span class="darke">url</span><span class="gold">)</span>;
    <span class="skyblue">document</span>.<span class="skyblue">body</span>.<span class="yellow">removeChild</span><span class="gold">(</span><span class="skyblue">a</span><span class="gold">)</span>;
<span class="darke">}</pre>
    <p>Luego creemos funciones que se encargaran de enviar, en donde currentFile es el archivo de imagen actual proveniente de un input:file. En este caso usamos la API de FormData() para una mayor legibilidad y envio de la imagen.</p>
    <pre>
<span class="blue">const</span> <span class="yellow">sendImg</span> = <span class="gold">(</span><span class="gold">)</span> <span class="blue">=></span> <span class="gold">{</span> 
    <span class="blue">const</span> <span class="darke">formdata</span> = <span class="blue">new</span> <span class="lightgreen">FormData</span><span class="purple">()</span>;
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'img'</span>, <span class="skyblue">currentFile</span><span class="purple">)</span>
    <span class="yellow">fetch</span><span class="purple">(</span><span class="brown">'/img/'</span>, <span class="blue">{</span><span class="skyblue">method:</span> <span class="brown">'post'</span>, <span class="skyblue">body:</span> <span class="darke">formdata</span><span class="blue">}</span><span class="purple">)</span>
        .<span class="yellow">then</span><span class="purple">(</span><span class="skyblue">res</span> <span class="blue">=></span> <span class="skyblue">res</span>.<span class="yellow">blob</span><span class="blue">()</span><span class="purple">)</span>
        .<span class="yellow">then</span><span class="purple">(</span><span class="yellow">downloadBlob</span><span class="purple">)</span>
<span class="gold">}</span></pre>
    <p>Ejemplo de envio de peticion de imagen base64.</p>
    <pre>
<span class="blue">const</span> <span class="yellow">sendBase64</span> = <span class="gold">(</span><span class="gold">)</span> <span class="blue">=></span> <span class="gold">{</span> 
    <span class="blue">const</span> <span class="darke">formdata</span> = <span class="blue">new</span> <span class="lightgreen">FormData</span><span class="purple">()</span>;
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'img_base64'</span>, <span class="skyblue">textarea.value</span><span class="purple">)</span>;
    <span class="yellow">fetch</span><span class="purple">(</span><span class="brown">'/img/base64'</span>, <span class="blue">{</span><span class="skyblue">method:</span> <span class="brown">'put'</span>, <span class="skyblue">body:</span> <span class="darke">formdata</span><span class="blue">}</span><span class="purple">)</span>;
        .<span class="yellow">then</span><span class="purple">(</span><span class="skyblue">res</span> <span class="blue">=></span> <span class="skyblue">res</span>.<span class="yellow">blob</span><span class="blue">()</span><span class="purple">)</span>
        .<span class="yellow">then</span><span class="purple">(</span><span class="yellow">downloadBlob</span><span class="purple">)</span>
<span class="gold">}</span></pre>
    <p>Ejemplo con peticion de imagen cuadrada y que retorne base64. En donde 'b64Checkbox' y 'boxCheckbox' son checkbox y accedemos a su valor booleano. Recuerda al especificar el valor 'box' como true no puedes usar los parametros de corte.</p>
    <pre>
<span class="blue">const</span> <span class="yellow">sendImg</span> = <span class="gold">(</span><span class="gold">)</span> <span class="blue">=></span> <span class="gold">{</span> 
    <span class="blue">const</span> <span class="darke">formdata</span> = <span class="blue">new</span> <span class="lightgreen">FormData</span><span class="purple">()</span>;
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'img'</span>, <span class="skyblue">currentFile</span><span class="purple">)</span>
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'b64'</span>, <span class="skyblue">b64Checkbox.checked</span><span class="purple">)</span>
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'box'</span>, <span class="skyblue">boxCheckbox.checked</span><span class="purple">)</span>

    <span class="yellow">fetch</span><span class="purple">(</span><span class="brown">'/img/'</span>, <span class="blue">{</span><span class="skyblue">method:</span> <span class="brown">'post'</span>, <span class="skyblue">body:</span> <span class="darke">formdata</span><span class="blue">}</span><span class="purple">)</span>
        .<span class="yellow">then</span><span class="purple">(</span><span class="skyblue">res</span> <span class="blue">=></span> <span class="skyblue">res</span>.<span class="yellow">json</span><span class="blue">()</span>
            .<span class="yellow">then</span><span class="purple">(</span><span class="skyblue">e</span> <span class="blue">=></span> <span class="skyblue">console</span>.<span class="yellow">log</span><span class="blue">(</span><span class="skyblue">e</span><span class="blue">)</span><span class="purple">)</span>
    <span class="purple">)</span>
<span class="gold">}</span></pre>
<p>Ejemplo usando el método crop recuerda que algunos valores no deben ser menores que otros. <a href="{{ url_for('doc') }}">Ver documentación.</a></p>
<pre>
<span class="blue">const</span> <span class="yellow">sendImg</span> = <span class="gold">(</span><span class="gold">)</span> <span class="blue">=></span> <span class="gold">{</span> 
    <span class="blue">const</span> <span class="darke">formdata</span> = <span class="blue">new</span> <span class="lightgreen">FormData</span><span class="purple">()</span>;
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'img'</span>, <span class="skyblue">currentFile</span><span class="purple">)</span>
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'top'</span>, <span class="skyblue">50</span><span class="purple">)</span>
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'left'</span>, <span class="skyblue">50</span><span class="purple">)</span>
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'right'</span>, <span class="skyblue">100</span><span class="purple">)</span>
    <span class="darke">formdata</span>.<span class="yellow">append</span><span class="purple">(</span><span class="brown">'bottom'</span>, <span class="skyblue">100</span><span class="purple">)</span>

    <span class="yellow">fetch</span><span class="purple">(</span><span class="brown">'/img/'</span>, <span class="blue">{</span><span class="skyblue">method:</span> <span class="brown">'post'</span>, <span class="skyblue">body:</span> <span class="darke">formdata</span><span class="blue">}</span><span class="purple">)</span>
        .<span class="yellow">then</span><span class="purple">(</span><span class="skyblue">res</span> <span class="blue">=></span> <span class="skyblue">res</span>.<span class="yellow">blob</span><span class="blue">()</span><span class="purple">)</span>
            .<span class="yellow">then</span><span class="purple">(</span><span class="yellow">downloadBlob</span><span class="purple">)</span>
<span class="gold">}</span></pre>
</main>
{% endblock %}

{% block scripts %}
{% endblock %}
